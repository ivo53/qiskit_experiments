import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit
x = np.linspace(0.001, 0.999, 500)
y = np.array(
    [0.02832031, 0.03222656, 0.03417969, 0.06005859, 0.08007812, 0.11474609
, 0.13427734, 0.18994141, 0.23339844, 0.25830078, 0.32861328, 0.390625
, 0.42138672, 0.48193359, 0.54052734, 0.58935547, 0.62841797, 0.68359375
, 0.73583984, 0.765625  , 0.81542969, 0.83496094, 0.87255859, 0.90673828
, 0.91601562, 0.91894531, 0.92724609, 0.92431641, 0.92236328, 0.90185547
, 0.89404297, 0.85986328, 0.83105469, 0.81054688, 0.75732422, 0.71728516
, 0.66601562, 0.62109375, 0.58447266, 0.53027344, 0.46582031, 0.42773438
, 0.36572266, 0.30957031, 0.27929688, 0.22753906, 0.17089844, 0.14013672
, 0.10351562, 0.07226562, 0.06884766, 0.04052734, 0.02148438, 0.02099609
, 0.02294922, 0.02539062, 0.03271484, 0.05126953, 0.07177734, 0.09521484
, 0.13769531, 0.16796875, 0.19287109, 0.26123047, 0.29541016, 0.34863281
, 0.38134766, 0.45068359, 0.46777344, 0.55566406, 0.57666016, 0.63037109
, 0.68066406, 0.71826172, 0.77050781, 0.81103516, 0.84082031, 0.86523438
, 0.88867188, 0.90234375, 0.93115234, 0.91894531, 0.92431641, 0.91210938
, 0.92138672, 0.89794922, 0.88134766, 0.85644531, 0.81689453, 0.79248047
, 0.74609375, 0.69335938, 0.6796875 , 0.63378906, 0.59960938, 0.53125
, 0.48974609, 0.4296875 , 0.36767578, 0.33056641, 0.29199219, 0.24121094
, 0.20117188, 0.16845703, 0.13085938, 0.10791016, 0.08300781, 0.04638672
, 0.05175781, 0.02246094, 0.02197266, 0.02490234, 0.02490234, 0.03857422
, 0.05908203, 0.08496094, 0.11474609, 0.12695312, 0.16113281, 0.21337891
, 0.24755859, 0.28466797, 0.33984375, 0.390625  , 0.43847656, 0.46826172
, 0.51660156, 0.56933594, 0.64208984, 0.66113281, 0.69677734, 0.76220703
, 0.77587891, 0.80224609, 0.83300781, 0.86865234, 0.86914062, 0.89550781
, 0.90185547, 0.91699219, 0.92529297, 0.9140625 , 0.89355469, 0.86816406
, 0.86230469, 0.84228516, 0.80126953, 0.79638672, 0.73828125, 0.69482422
, 0.66064453, 0.60253906, 0.58398438, 0.52587891, 0.47412109, 0.41699219
, 0.39013672, 0.32714844, 0.31054688, 0.24755859, 0.18847656, 0.17578125
, 0.12207031, 0.1171875 , 0.07763672, 0.06005859, 0.04248047, 0.02685547
, 0.02490234, 0.01953125, 0.02880859, 0.03320312, 0.04882812, 0.06347656
, 0.09130859, 0.1171875 , 0.15380859, 0.17333984, 0.22851562, 0.26025391
, 0.29882812, 0.375     , 0.39501953, 0.44775391, 0.48193359, 0.5390625
, 0.60742188, 0.61132812, 0.68310547, 0.69335938, 0.75244141, 0.79101562
, 0.79638672, 0.83496094, 0.86621094, 0.89208984, 0.90380859, 0.90380859
, 0.91357422, 0.90673828, 0.91992188, 0.91113281, 0.89501953, 0.87353516
, 0.86914062, 0.82861328, 0.81347656, 0.76953125, 0.74951172, 0.69726562
, 0.66601562, 0.59375   , 0.54833984, 0.51220703, 0.48583984, 0.41308594
, 0.39794922, 0.34619141, 0.27636719, 0.25390625, 0.22802734, 0.18261719
, 0.13378906, 0.10742188, 0.09130859, 0.08056641, 0.05078125, 0.03515625
, 0.02734375, 0.02099609, 0.02050781, 0.01757812, 0.03173828, 0.0390625
, 0.06152344, 0.08105469, 0.10400391, 0.12988281, 0.16259766, 0.20849609
, 0.2265625 , 0.27929688, 0.328125  , 0.33789062, 0.38427734, 0.47900391
, 0.51074219, 0.5546875 , 0.60058594, 0.63476562, 0.65185547, 0.70898438
, 0.71240234, 0.76953125, 0.79101562, 0.84814453, 0.86230469, 0.875
, 0.89208984, 0.90771484, 0.90478516, 0.92578125, 0.9296875 , 0.91845703
, 0.92041016, 0.89404297, 0.88378906, 0.87988281, 0.85253906, 0.80908203
, 0.81982422, 0.76416016, 0.74365234, 0.70703125, 0.66210938, 0.61328125
, 0.58642578, 0.55175781, 0.52197266, 0.47705078, 0.43310547, 0.39306641
, 0.35986328, 0.30126953, 0.27099609, 0.23388672, 0.18505859, 0.15771484
, 0.14990234, 0.10986328, 0.07910156, 0.06835938, 0.04589844, 0.03564453
, 0.03027344, 0.02148438, 0.02197266, 0.02587891, 0.02978516, 0.03613281
, 0.06152344, 0.06542969, 0.09033203, 0.12255859, 0.12451172, 0.18505859
, 0.19775391, 0.21923828, 0.27294922, 0.31152344, 0.35449219, 0.35302734
, 0.39746094, 0.44384766, 0.48828125, 0.54638672, 0.55615234, 0.59716797
, 0.640625  , 0.66748047, 0.70800781, 0.73730469, 0.76269531, 0.78564453
, 0.82519531, 0.85986328, 0.87646484, 0.88916016, 0.90283203, 0.91357422
, 0.92089844, 0.92333984, 0.92333984, 0.92236328, 0.92480469, 0.91357422
, 0.90527344, 0.88525391, 0.87548828, 0.86083984, 0.828125  , 0.8046875
, 0.80126953, 0.75830078, 0.72265625, 0.69433594, 0.67480469, 0.625
, 0.59667969, 0.56396484, 0.52880859, 0.47753906, 0.46484375, 0.41796875
, 0.37646484, 0.34130859, 0.31689453, 0.30078125, 0.24902344, 0.21240234
, 0.18847656, 0.14648438, 0.14746094, 0.11230469, 0.10546875, 0.07958984
, 0.05761719, 0.04882812, 0.03515625, 0.03125   , 0.0234375 , 0.02783203
, 0.02636719, 0.02929688, 0.04248047, 0.046875  , 0.05957031, 0.06738281
, 0.08300781, 0.11328125, 0.13183594, 0.13964844, 0.16552734, 0.18505859
, 0.21337891, 0.25195312, 0.27246094, 0.30322266, 0.33935547, 0.39648438
, 0.40039062, 0.4453125 , 0.46191406, 0.51318359, 0.55566406, 0.5859375
, 0.59667969, 0.63183594, 0.65917969, 0.66748047, 0.69482422, 0.73388672
, 0.76855469, 0.77783203, 0.81445312, 0.83544922, 0.86083984, 0.86767578
, 0.88330078, 0.89111328, 0.90087891, 0.90625   , 0.91064453, 0.91162109
, 0.91699219, 0.93505859, 0.91748047, 0.91552734, 0.90966797, 0.90185547
, 0.89306641, 0.88623047, 0.86181641, 0.86230469, 0.83251953, 0.83837891
, 0.79638672, 0.78955078, 0.76757812, 0.73046875, 0.72265625, 0.6875
, 0.65917969, 0.62744141, 0.6171875 , 0.55712891, 0.54443359, 0.52099609
, 0.51416016, 0.46826172, 0.43115234, 0.38867188, 0.39550781, 0.36035156
, 0.32763672, 0.29492188, 0.27685547, 0.24853516, 0.23144531, 0.19384766
, 0.18261719, 0.1796875 , 0.15478516, 0.13232422, 0.13427734, 0.11132812
, 0.08886719, 0.07226562, 0.06689453, 0.05273438, 0.04345703, 0.04003906
, 0.03076172, 0.02734375, 0.02099609, 0.02197266, 0.02148438, 0.02685547
, 0.02783203, 0.03125   , 0.04296875, 0.05273438, 0.05419922, 0.06201172
, 0.07958984, 0.09228516, 0.09863281, 0.11230469, 0.11425781, 0.14160156
, 0.15283203, 0.17041016, 0.19335938, 0.20410156, 0.2265625 , 0.24853516
, 0.25195312, 0.27783203, 0.31054688, 0.33056641, 0.35449219, 0.38037109
, 0.37109375, 0.41748047, 0.43896484, 0.46142578, 0.44824219, 0.51611328
, 0.52148438, 0.53662109]
)
def fit_function(x_values, y_values, function, init_params):
    fitparams, conv = curve_fit(
        function, 
        x_values, 
        y_values, 
        init_params,
        maxfev=100000, 
        bounds=(
            [-0.53, 1, 1, 0, 0.45], 
            [-.47, 100, 100, 1000, 0.55]
        )
    )
    y_fit = function(x_values, *fitparams)
    
    return fitparams, y_fit


fitparams, _ = fit_function(
    x, y, 
    lambda x, A, k, l, p, B: A * (np.cos(k*x + l * (1 - np.exp(-p*x)))) + B,
    [-.5, 36.4, 16, 2, 0.5]
)
print(fitparams)
A,k,l,p,B = fitparams
# A, k, l, B = fit_function2(
#     x, y, 
#     lambda x, A, k, l, B: A * (np.cos(k * (x) + l * np.sqrt(x))) + B,
#     [-.45, 40, 7, 0.5],
#     [.001, .1, .01, .001]
# )
# A, k, l, B = [-.45, 40, 7, 0.5]
x_ext = np.linspace(x[0], x[-1], 10000)
extended_y_fit = A * (np.cos(k*x_ext + l * (1-np.exp(-p*x_ext)))) + B
plt.plot(x, y, "bx")
plt.plot(x_ext, extended_y_fit, color='red')
plt.show()
